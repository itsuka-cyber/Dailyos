<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>// Admin - daily.log</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="terminal admin-terminal">
    <header class="terminal-header">
      <div class="dots">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot green"></span>
      </div>
      <div class="title">~/life/admin.html</div>
    </header>
    <main class="terminal-body">
      <form id="noteForm" enctype="multipart/form-data">
        <label for="noteDate">Tanggal:</label>
        <input type="date" id="noteDate" name="noteDate" required />
        <label for="noteTags">Tag (pisah koma):</label>
        <input type="text" id="noteTags" name="noteTags" placeholder="belajar,life,2025" />
        <label for="noteTitle">Judul:</label>
        <input type="text" id="noteTitle" name="noteTitle" required />
        <label for="noteContent">Isi Catatan:</label>
        <textarea id="noteContent" name="noteContent" rows="6" required></textarea>
        <label for="noteFile">Upload Foto/Dokumen/Video:</label>
        <input type="file" id="noteFile" name="noteFile" accept="image/*,video/*,.pdf,.doc,.docx" multiple />
        <button type="submit">Simpan Catatan</button>
      </form>
      <div id="message" role="alert"></div>
      <a href="index.html" class="admin-link">// kembali ke halaman utama</a>
    </main>
  </div>
  <script>
    const form = document.getElementById("noteForm");
    const messageBox = document.getElementById("message");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const noteDate = form.noteDate.value;
      const noteTags = form.noteTags.value.split(",").map((t) => t.trim()).filter(Boolean);
      const noteTitle = form.noteTitle.value.trim();
      const noteContent = form.noteContent.value.trim();

      // Ambil files dari input
      const files = form.noteFile.files;
      let filePreviews = [];

      // Konversi file ke Base64 (hanya file kecil < 2MB)
      for (let file of files) {
        if (file.size > 1024 * 1024 * 2) continue; // skip file >2MB
        const reader = new FileReader();
        reader.readAsDataURL(file);
        await new Promise((resolve) => {
          reader.onload = () => {
            filePreviews.push({
              name: file.name,
              type: file.type,
              data: reader.result
            });
            resolve();
          };
        });
      }

      if (!noteDate || !noteTitle || !noteContent) {
        showMessage("Semua field wajib diisi!", "error");
        return;
      }

      const note = {
        date: noteDate,
        tags: noteTags,
        title: noteTitle,
        content: noteContent,
        files: filePreviews,
      };

      let notes = JSON.parse(localStorage.getItem("dailyNotes") || "[]");
      notes.push(note);
      localStorage.setItem("dailyNotes", JSON.stringify(notes));

      showMessage("Catatan dan file berhasil disimpan!", "success");

      form.reset();
    });

    function showMessage(msg, type) {
      messageBox.textContent = msg;
      messageBox.style.color = type === "success" ? "#5af78e" : "#ff5c57";
      setTimeout(() => {
        messageBox.textContent = "";
      }, 3000);
    }
  </script>
</body>
</html>